{% extends "base.html" %}

{% block title %}{{ car.name }} - 상상렌트카{% endblock %}

{% block content %}
<!-- Car Detail Section -->
<section class="py-16 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Car Media (Video + Images) -->
            <div class="lg:col-span-2">
                {% set images = car.get_images_list() %}
                {% if car.video %}
                    <!-- Video Section -->
                    <div class="relative overflow-hidden rounded-2xl shadow-2xl mb-6">
                        <div class="w-full aspect-[16/10] bg-gray-100">
                            <video id="mainVideo" autoplay muted controls class="w-full h-full object-contain autoplay-video">
                                <source src="{{ url_for('static', filename='uploads/' + car.video) }}" type="video/mp4">
                                브라우저가 동영상을 지원하지 않습니다.
                            </video>
                        </div>
                    </div>
                {% endif %}

                {% if images %}
                    <div class="relative overflow-hidden rounded-2xl shadow-2xl">
                        <div class="w-full aspect-[16/10] bg-gray-100">
                            <img id="mainImage" src="{{ url_for('static', filename='uploads/' + images[0]) }}"
                                 class="w-full h-full object-contain" alt="{{ car.name }}">
                        </div>

                        {% if images|length > 1 %}
                            <!-- Thumbnail Images -->
                            <div class="flex space-x-2 mt-4 overflow-x-auto pb-2">
                                {% for image in images[:8] %}
                                    <button data-image="{{ url_for('static', filename='uploads/' + image) }}"
                                            class="thumbnail-btn flex-shrink-0 w-20 h-20 rounded-lg overflow-hidden border-2 border-gray-200 hover:border-primary-600 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-600">
                                        <img src="{{ url_for('static', filename='uploads/' + image) }}"
                                             class="w-full h-full object-contain bg-gray-100" alt="썸네일 {{ loop.index }}">
                                    </button>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                {% elif not car.video %}
                    <div class="w-full h-96 lg:h-[500px] bg-gradient-to-br from-gray-100 to-gray-200 rounded-2xl flex items-center justify-center shadow-xl">
                        <i class="fas fa-car text-8xl text-gray-400"></i>
                    </div>
                {% endif %}
            </div>

            <!-- Car Information -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-2xl shadow-xl p-8 sticky top-8">
                    <h1 class="text-3xl font-bold text-gray-900 mb-6">{{ car.name }}</h1>

                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-primary-700 mb-4">대여료 (시간별)</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center p-4 bg-primary-50 rounded-xl border-l-4 border-primary-600">
                                <span class="font-medium text-gray-700">공항픽업/2시간</span>
                                <span class="text-xl font-bold text-primary-700">{{ "{:,}".format(car.price_2h) }} VND</span>
                            </div>
                            <div class="flex justify-between items-center p-4 bg-primary-50 rounded-xl border-l-4 border-primary-600">
                                <span class="font-medium text-gray-700">4시간</span>
                                <span class="text-xl font-bold text-primary-700">{{ "{:,}".format(car.price_4h) }} VND</span>
                            </div>
                            <div class="flex justify-between items-center p-4 bg-primary-50 rounded-xl border-l-4 border-primary-600">
                                <span class="font-medium text-gray-700">8시간</span>
                                <span class="text-xl font-bold text-primary-700">{{ "{:,}".format(car.price_8h) }} VND</span>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-4 mb-8">
                        <a href="tel:+84708000002"
                           class="block w-full text-center px-6 py-4 bg-primary-600 text-white rounded-xl font-semibold text-lg hover:bg-primary-700 transition-all duration-200 shadow-lg hover:shadow-xl">
                            <i class="fas fa-phone mr-2"></i>이 차량 예약하기
                        </a>
                        <a href="{{ url_for('cars') }}"
                           class="block w-full text-center px-6 py-4 border-2 border-gray-300 text-gray-700 rounded-xl font-medium hover:border-primary-600 hover:text-primary-600 transition-all duration-200">
                            <i class="fas fa-arrow-left mr-2"></i>차량 목록으로
                        </a>
                    </div>

                    {% if car.description %}
                        <div class="border-t pt-6">
                            <h4 class="text-lg font-semibold text-gray-900 mb-3">차량 설명</h4>
                            <p class="text-gray-600 leading-relaxed">{{ car.description|nl2br|safe }}</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Handle newlines in description
    const description = document.querySelector('.car-description p');
    if (description) {
        description.innerHTML = description.textContent.replace(/\n/g, '<br>');
    }

    // Handle thumbnail image switching
    const thumbnailButtons = document.querySelectorAll('.thumbnail-btn');
    const mainImage = document.getElementById('mainImage');

    thumbnailButtons.forEach(button => {
        button.addEventListener('click', function() {
            const imageSrc = this.getAttribute('data-image');
            if (mainImage && imageSrc) {
                mainImage.src = imageSrc;
                // Update active state
                thumbnailButtons.forEach(btn => btn.classList.remove('border-primary-600'));
                this.classList.add('border-primary-600');
            }
        });
    });

    // Handle video autoplay - play once and stop
    const videos = document.querySelectorAll('.autoplay-video');

    videos.forEach(video => {
        video.addEventListener('ended', function() {
            // Video will automatically stop after playing once (no loop)
        });
    });
});
</script>
{% endblock %}
